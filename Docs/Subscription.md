>[!question]
>GQ1. Combineì—ì„œ Subscriptionì˜ ì—­í• ì€ ë­˜ê¹Œ?
>GQ2. Publisherì™€ Subscriberë¥¼ ì—°ê²°í•˜ëŠ” íë¦„ì´ ì–´ë–»ê²Œ ë ê¹Œ?

## GQ1.  Combineì—ì„œ Subscriptionì˜ ì—­í• 
Combineì—ì„œ Publisherì™€ Subscriberê°€ ì—°ê²°ë˜ëŠ” íë¦„ì„ ë³´ë©´ ê°‘ìê¸° Subscriptionì´ë¼ëŠ” ê°œë…ì´ ì–¸ê¸‰ë©ë‹ˆë‹¤. ë„ˆë¬´ ë§ì€ ìš©ì–´ê°€ ë‚˜ì™€ì„œ í˜¼ë€ìŠ¤ëŸ¬ìš¸ ìˆ˜ë„ ìˆì§€ë§Œ ì‚¬ì‹¤ Combineì—ì„œ ì •ë§ ì¤‘ìš”í•œ ì—­í• ì„ ë‹´ë‹¹í•˜ê³  ìˆëŠ” ì¹œêµ¬ì¸ Subscriptionì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

ì´ì „ì— Combineì—ì„œ ì •ë¦¬í–ˆë˜ ê±¸ ë³´ë©´ Publisherê°€ subscriptionì„ Subscriberì—ê²Œ ë„˜ê¸´ ë‹¤ìŒì—ë„ Subscriberì™€ ì§ì ‘ ê°’ì„ ì£¼ê³ ë°›ëŠ” ê²ƒì²˜ëŸ¼ ë‚˜ì™€ìˆëŠ”ë°ìš”, ì‚¬ì‹¤ ìì„¸íˆ ë“¤ì—¬ë‹¤ë³´ë‹ˆ ê·¸ê²Œ ì „ë¶€ê°€ ì•„ë‹ˆì—ˆìŠµë‹ˆë‹¤.

![[ìŠ¤í¬ë¦°ìƒ· 2025-06-18 ì˜¤ì „ 1.29.11.png]]

### Publisher â†’ Subscription â†’ Subscriber
ì‹¤ì œë¡œëŠ” Publisherê°€ Subscriptionì„ ë§Œë“¤ì–´ì„œ Subscriptionì—ê²Œ ë„˜ê²¨ì£¼ê³  ë‚˜ë©´,
Publisherì™€ Subscriberê°€ ì§ì ‘ ì—°ê²°ë˜ì§€ ì•Šê³  ì¤‘ê°„ì—ì„œ Subscriptionì´ ì¤‘ê°œ ì—­í• ì„ í•˜ê²Œ ë©ë‹ˆë‹¤.

![[Pasted image 20250618012805.png]]

ì¦‰, PublisherëŠ” ë‹¨ìˆœíˆ ê°’ì„ '**ë°œìƒì‹œí‚¤ëŠ”** ì£¼ì²´'ì¼ ë¿, ê·¸ ê°’ì„ ì–´ë–»ê²Œ ì–¼ë§ˆë‚˜ ì „ë‹¬í• ì§€ëŠ” Subscriptionì´ ë‹´ë‹¹í•©ë‹ˆë‹¤.


### ê·¸ë˜ì„œ Subscriptionì€ ë­£ì„ í•˜ëŠëƒ?

1. ê°’ ì „ë‹¬ ì¡°ìœ¨
	- Publisherê°€ ìƒˆ ê°’ì„ ë§Œë“¤ì—ˆì„ ë•Œ, Subscriptionì´ Subscriberì—ê²Œ ì „ë‹¬í• ì§€ë¥¼ íŒë‹¨í•©ë‹ˆë‹¤.
	- ì´ íŒë‹¨ì˜ ê¸°ì¤€ì€ Subscriberê°€ ìš”ì²­í•œ ì–‘(Demand)
	- Subscriberê°€ ìš”ì²­í•œ ì–‘ë³´ë‹¤ ë” ë§ì€ ê°’ì„ ë°›ì§€ ì•Šë„ë¡ íë¦„ì„ ì œì–´í•©ë‹ˆë‹¤.

2. ì°¸ì¡° ê´€ë¦¬
	: Subscriptionì€ Subscriberë¥¼ ë³´ìœ (retain)í•˜ê³ , í•„ìš” ì—†ì–´ì§€ë©´ í•´ì œí•´ì¤ë‹ˆë‹¤.

3. Publisher: ë°”ì§€ì‚¬ì¥ğŸ‘–
	- Subscriptionì´ ì—°ê²°ë˜ê³  ë‚˜ë©´, PublisherëŠ” ì‹¤ì œ ê°’ ì „ë‹¬ì—ëŠ” ê±°ì˜ ê´€ì—¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
	- ì‹¤ì§ˆì ì¸ ë™ì‘ì€ Subscriptionê³¼ Subscriberê°€ ì£¼ê³ ë°›ìœ¼ë©° ì´ë£¨ì–´ì§€ê³ , PublisherëŠ” Subscriptionì—ê²Œ ê°’ì„ ì£¼ê±°ë‚˜ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•  ë¿(ì‹œì‘ì ì˜ ì—­í• ë§Œ!), ì§ì ‘ Subscriberì™€ ì†Œí†µí•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.

> [! ì •ë¦¬]
>-  Combineì—ì„œ ì‹¤ì œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ê±´ ëŒ€ë¶€ë¶„ Subscriptionê³¼ Subscriberì´ë‹¤.
>-  PublisherëŠ” ì¼ì¢…ì˜ ì‹œì‘ì ì¼ ë¿!(ë°”ì§€ì‚¬ì¥)
>- Subscriptionì´ Subscriberì˜ ìš”ì²­ì„ ë°›ì•„ì„œ ê°’ì„ ì „ë‹¬í•˜ê±°ë‚˜ ì§ì ‘ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë“±ì˜ ì¤‘ê°œì ì—­í• ì„ ë§¡ëŠ”ë‹¤.

### ê³µì‹ë¬¸ì„œ íŒŒë³´ê¸°
ê³µì‹ë¬¸ì„œì˜ ì„¤ëª…ì„ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë‚˜ì™€ìˆìŠµë‹ˆë‹¤.

> A protocol representing the connection of a subscriber to a publisher.
> : Publisherì™€ Subscriber ì‚¬ì´ì˜ ì—°ê²°ì„ ë‚˜íƒ€ë‚´ëŠ” í”„ë¡œí† ì½œ

```swift
public protocol Subscription: Cancellable, CustomCombineIdentifierConvertible {
    func request(_ demand: Subscribers.Demand)
}
```

- `request(_:)` 
  : Publisherì—ê²Œ ë” ë§ì€ ê°’ì„ Subscriberì—ê²Œ ë³´ë‚´ë„ ëœë‹¤ê³  ì•Œë¦°ë‹¤.
	- Subscriberê°€ **â€œì´ë§Œí¼ ë°›ì„ê²Œìš”â€** ë¼ê³  ë§í•˜ë©´, Subscriptionì´ ê·¸ê±¸ ë°›ì•„ì„œ **Publisherì—ê²Œ ë” ë³´ë‚´ë„ ëœë‹¤**ê³  ì•Œë ¤ì£¼ëŠ” ì—­í• 
	- ì²˜ìŒ ì—°ê²°ë  ë•Œë„, ì¤‘ê°„ì¤‘ê°„ ë” ë°›ì„ ì¤€ë¹„ê°€ ëì„ ë•Œë„ ì´ request()ë¥¼ í˜¸ì¶œ

>[! Overview]
>1. **Subscriptions are class constrained** because a Subscription has identity, defined by the moment in time a particular subscriber attached to a publisher.
>2. Canceling a Subscription must be thread-safe.
>	- You can only cancel a Subscription once.
>	- Cancelling a subscription frees up any resources previously allocated by attaching the Subscriber

##### **Subscriptionì€ í´ë˜ìŠ¤ íƒ€ì…ìœ¼ë¡œë§Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.**
ì™œëƒí•˜ë©´ Subscriptionì€ ì •ì²´ì„±(identity)ì„ ê°€ì§€ê¸° ë•Œë¬¸ì¸ë°, 
ê·¸ ì •ì²´ì„±ì€ íŠ¹ì • Subscriberê°€ Publisherì— ì—°ê²°ëœ â€˜ì‹œì â€™ì— ì˜í•´ ì •ì˜ë˜ê¸° ë•Œë¬¸
	
- Subscriptionì€ ë‹¨ìˆœíˆ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” ë„êµ¬ê°€ ì•„ë‹ˆë¼ íŠ¹ì • Subscriberê°€ Publisherì— ì—°ê²°ë˜ë©´ì„œ ìƒê¸´ ê³ ìœ í•œ ì—°ê²° ê´€ê³„ ìì²´
- ëˆ„ê°€(Subscriber) ì–´ë–¤ Publisherë¥¼ êµ¬ë…í–ˆëŠ”ì§€, ì–¸ì œ ì—°ê²°ë˜ì—ˆëŠ”ì§€, ì–¼ë§Œí¼ì˜ ë°ì´í„°ë¥¼ ìš”ì²­í–ˆëŠ”ì§€ì™€ ê°™ì€ ìš”ì†Œë“¤ì— ë”°ë¼ êµ¬ë¶„ë¨
- êµ¬ë…ì´ë¼ëŠ” í–‰ìœ„ì˜ ê²°ê³¼ë¡œ ìƒê¸´ ê³ ìœ í•œ ì¸ìŠ¤í„´ìŠ¤

â‡’ í´ë˜ìŠ¤ëŠ” ì°¸ì¡° íƒ€ì…ì´ê¸° ë•Œë¬¸ì— ê°ì²´ ìƒíƒœ ê³µìœ  ë° ì¶”ì ì´ ìš©ì´í•˜ê¸° ë•Œë¬¸ì— subscriptionì€ í´ë˜ìŠ¤ íƒ€ì…ìœ¼ë¡œë§Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤!

##### Subscriptionì˜ ì·¨ì†Œ(cancel)ëŠ” ìŠ¤ë ˆë“œ ì•ˆì „(thread-safe)í•´ì•¼ í•œë‹¤
- Cancellable í”„ë¡œí† ì½œì„ ì±„íƒí•˜ê³  ìˆì–´ì„œ êµ¬ë…ì„ ì¤‘ë‹¨í•˜ê³  ë¦¬ì†ŒìŠ¤ë¥¼ í•´ì œí•˜ëŠ” `cancel()` ë©”ì„œë“œë¥¼ ê°€ì§€ê³  ìˆìŒ
- ì—¬ëŸ¬ ìŠ¤ë ˆë“œì—ì„œ ë™ì‹œì— êµ¬ë…ì„ ì·¨ì†Œí•˜ë ¤ëŠ” ìƒí™©ì´ ìƒê¸¸ ìˆ˜ ìˆëŠ”ë° ê·¸ ë•Œì—ë„ ë¬¸ì œ ì—†ë„ë¡ í•œ ë²ˆë§Œ ì•ˆì „í•˜ê²Œ ì·¨ì†Œë˜ì–´ì•¼ í•œë‹¤!

## GQ2. Publisherì™€ Subscriberë¥¼ ì—°ê²°í•˜ëŠ” íë¦„ì´ ì–´ë–»ê²Œ ë ê¹Œ?

ë°±ë¬¸ì´ ë¶ˆì—¬ì¼ê²¬. ì´ì œ ì‹¤ì œ ì½”ë“œë¥¼ í†µí•´ Publisher, Subscriber, Subscriptionì´ ì–´ë–»ê²Œ êµ¬í˜„ë˜ê³  ì„œë¡œ ì—°ê²°ë˜ëŠ”ì§€ ì§ì ‘ ëˆˆìœ¼ë¡œ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.
#### Publisher
âœ”ï¸ Outputì´ ì œë„ˆëŸ´ë¡œ êµ¬í˜„ë˜ì–´ ìˆìŒ
âœ”ï¸ receive ë©”ì„œë“œ ì•ˆì—ì„œ Subscriptionì´ ë§Œë“¤ì–´ì ¸ì„œ subscriberì˜ receive í•¨ìˆ˜ë¡œ ê±´ë„¤ì£¼ê³  ìˆìŒ
```swift
extension URLSession {
  struct DecodedDataTaskPublisher<Output: Decodable>: Publisher {
    typealias Failure = Error

    let urlRequest: URLRequest

    func receive<S>(subscriber: S) where S : Subscriber, Failure == S.Failure, Output == S.Input {
      let subscription = DecodedDataTaskSubscription(urlRequest: urlRequest, subscriber: subscriber)
      subscriber.receive(subscription: subscription)
    }
  }

  func decodedDataTaskPublisher<Output: Decodable>(for urlRequest: URLRequest) -> DecodedDataTaskPublisher<Output> {
    return DecodedDataTaskPublisher<Output>(urlRequest: urlRequest)
  }
}
```
#### Subscriber
âœ”ï¸ SubscriberëŠ” `subscription.request(_:)`ë¥¼ í˜¸ì¶œí•´ì•¼ ê°’ì´ ì˜¨ë‹¤
âœ”ï¸ ìˆ˜ëª… ê´€ë¦¬: subscriptionì€ ì €ì¥í•´ì„œ ì·¨ì†Œ ê°€ëŠ¥í•˜ê²Œ í•´ì•¼ í•œë‹¤.
âœ”ï¸ ê°’ì„ ë°›ì•„ë„ ë‹¤ì‹œ ìš”ì²­í•˜ì§€ ì•Šìœ¼ë©´ ë”ì´ìƒ ì˜¤ì§€ ì•ŠëŠ”ë‹¤: `receive(_:)`ì—ì„œ .noneì„ ë¦¬í„´í•˜ë©´ demandë¥¼ ë” ëŠ˜ë¦¬ì§€ ì•Šê² ë‹¤ëŠ” ëœ»
```swift
class DecodableDataTaskSubscriber<Input: Decodable>: Subscriber, Cancellable {
	typealias Failure = Error
	
	var subscription: Subscription?
	
	func receive(subscription: Subscription) {
		print("Received subscription")
		self.subscription = subscription // ì €ì¥
		subscription.request(.unlimited)
	}
	
	func receive(_ input: Input) -> Subscribers.Demand {
		print("Received value: \(input)")
		return .none
	}
	
	func receive(completion: Subscribers.Completion<Error>) {
		print("Received completion \(completion)")
		cancel()
	}

	// ì·¨ì†Œ
	func cancel() {
		subscription?.cancel()
		subscription = nil
	}
}
```

#### Subscription
âœ”ï¸ `request(_:)`
	: Subscriberê°€ ê°’ì„ ìš”ì²­í•˜ê³ , ê·¸ demandê°€ 0ë³´ë‹¤ í¬ë©´ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì´ ì‹œì‘ë¨
âœ”ï¸ ì‘ì—… ì™„ë£Œ í›„ `cancel()` í˜¸ì¶œ
	- dataTaskì˜ ì‘ë‹µì„ ì²˜ë¦¬í•œ í›„ì—ëŠ” deferë¥¼ ì´ìš©í•´ cancel()ì„ í˜¸ì¶œ
âœ”ï¸ ê°’ ì „ë‹¬ê³¼ ì™„ë£Œ/ì‹¤íŒ¨ ì²˜ë¦¬ê¹Œì§€ Subscriptionì´ ë§¡ëŠ”ë‹¤(ì¤‘ê°œì ì—­í• )
```swift
extension URLSession.DecodedDataTaskPublisher {
  class DecodedDataTaskSubscription<Output: Decodable, S: Subscriber>: Subscription
    where S.Input == Output, S.Failure == Error {

    private let urlRequest: URLRequest
    private var subscriber: S?

    init(urlRequest: URLRequest, subscriber: S) {
      self.urlRequest = urlRequest
      self.subscriber = subscriber
    }

    func request(_ demand: Subscribers.Demand) {
      if demand > 0 {
        URLSession.shared.dataTask(with: urlRequest) { [weak self] data, response, error in
          defer { self?.cancel() }

          if let data = data {
            do {
              let result = try JSONDecoder().decode(Output.self, from: data)
              self?.subscriber?.receive(result)
              self?.subscriber?.receive(completion: .finished)
            } catch {
              self?.subscriber?.receive(completion: .failure(error))
            }
          } else if let error = error {
            self?.subscriber?.receive(completion: .failure(error))
          }
        }.resume()
      }
    }

    func cancel() {
      subscriber = nil
    }
  }
}
```

## References
[Documentation) Subscription](https://developer.apple.com/documentation/combine/subscription)
[Understanding Combineâ€™s publishers and subscribers](https://www.donnywals.com/understanding-combines-publishers-and-subscribers/)
[Publisherì™€ Subscriberê°„ ì—°ê²° ê³¼ì • ë”¥ë‹¤ì´ë¸Œ](https://codingmon.tistory.com/71)
